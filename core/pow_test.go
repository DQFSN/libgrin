// Copyright 2018 BlockCypher
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package core

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

func TestVerifySize(t *testing.T) {
	prePoW := []uint8{0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 109, 239}
	bh := new(BlockHeader)
	bh.PoW.Nonce = 28143
	bh.PoW.Proof.EdgeBits = 15
	bh.PoW.Proof.Nonces = []uint64{749, 873, 927, 1637, 2687, 3668, 4346, 5192, 5787, 6055, 6270, 7064, 7140, 7474, 7805, 9017, 9095, 9492, 10634, 11708, 11785, 11799, 12362, 12498, 12667, 13680, 13941, 15360, 17955, 18519, 18691, 20589, 22113, 23605, 24538, 24871, 24945, 25137, 27372, 29195, 31787, 32687}
	assert.Nil(t, VerifySize(Mainnet, prePoW, bh))
}

func TestVerifySize2(t *testing.T) {
	prePoW := []uint8{0, 1, 0, 0, 0, 0, 0, 0, 166, 143, 0, 0, 0, 0, 92, 97, 221, 123, 65, 75, 2, 126, 250,
		225, 45, 158, 210, 248, 55, 105, 130, 90, 94, 118, 135, 252, 69, 37, 52, 50, 194, 170,
		145, 153, 2, 30, 128, 217, 37, 221, 147, 20, 62, 61, 126, 215, 67, 191, 62, 42, 186,
		32, 5, 198, 186, 40, 161, 236, 126, 109, 184, 26, 161, 190, 73, 222, 239, 118, 83, 183,
		71, 73, 132, 11, 64, 125, 146, 139, 225, 244, 47, 141, 199, 90, 76, 56, 244, 136, 121,
		185, 23, 216, 41, 133, 1, 241, 186, 2, 77, 240, 57, 63, 126, 162, 125, 227, 34, 164,
		26, 107, 220, 53, 77, 101, 171, 75, 116, 63, 83, 159, 171, 197, 12, 45, 135, 48, 30,
		114, 93, 101, 112, 37, 24, 147, 140, 41, 119, 150, 116, 16, 37, 126, 102, 215, 165,
		123, 55, 207, 43, 81, 54, 220, 0, 255, 147, 139, 28, 4, 108, 212, 207, 194, 201, 226,
		112, 192, 69, 189, 145, 238, 225, 99, 88, 238, 153, 38, 147, 44, 113, 155, 215, 33, 80,
		6, 55, 35, 208, 211, 100, 18, 179, 165, 128, 210, 171, 164, 141, 246, 193, 166, 0, 0,
		0, 0, 0, 2, 245, 206, 0, 0, 0, 0, 0, 2, 7, 66, 0, 0, 0, 3, 199, 132, 143, 238, 0, 0, 0,
		13, 16, 89, 244, 58, 146, 89, 127, 83,
	}
	bh := new(BlockHeader)
	bh.PoW.Nonce = 1178241309934714707
	bh.PoW.Proof.EdgeBits = 29
	bh.PoW.Proof.Nonces = []uint64{
		18852094, 18878486, 39783881, 59379092, 62326621, 71455167, 131832576, 143026722,
		143954436, 155338092, 199111429, 207884782, 211343283, 226025553, 233881058, 237856564,
		244323712, 246236308, 253743368, 258760447, 259000289, 262474233, 268999312, 303276522,
		348709059, 371226190, 380435344, 381559211, 382415438, 385006790, 385328950, 389303551,
		424071479, 431735335, 462433478, 476234373, 512600249, 513776715, 514612369, 518186065,
		526136923, 533118850,
	}
	assert.Nil(t, VerifySize(Mainnet, prePoW, bh))
}
